"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};"undefined"===_typeof(Craft.Freeform)&&(Craft.Freeform={}),Craft.Freeform.SubmissionsTableView=Craft.TableElementIndexView.extend({startDate:null,endDate:null,startDatepicker:null,endDatepicker:null,$chartExplorer:null,$totalValue:null,$chartContainer:null,$spinner:null,$error:null,$chart:null,$startDate:null,$endDate:null,afterInit:function(){this.$explorerContainer=$('<div class="chart-explorer-container"></div>').prependTo(this.$container),this.createChartExplorer(),this.base()},getStorage:function(t){return Craft.Freeform.SubmissionsTableView.getStorage(this.elementIndex._namespace,t)},setStorage:function(t,e){Craft.Freeform.SubmissionsTableView.setStorage(this.elementIndex._namespace,t,e)},createChartExplorer:function(){var t=$('<div class="chart-explorer"></div>').appendTo(this.$explorerContainer),e=$('<div class="chart-header"></div>').appendTo(t),a=$('<div class="date-range" />').appendTo(e),r=$('<div class="datewrapper"></div>').appendTo(a),s=($('<span class="to light">to</span>').appendTo(a),$('<div class="datewrapper"></div>').appendTo(a)),i=$('<div class="total"></div>').appendTo(e),n=($('<div class="total-label light">'+Craft.t("Total Submissions")+"</div>").appendTo(i),$('<div class="total-value-wrapper"></div>').appendTo(i)),o=$('<span class="total-value">&nbsp;</span>').appendTo(n);this.$chartExplorer=t,this.$totalValue=o,this.$chartContainer=$('<div class="chart-container"></div>').appendTo(t),this.$spinner=$('<div class="spinner hidden" />').prependTo(e),this.$error=$('<div class="error"></div>').appendTo(this.$chartContainer),this.$chart=$('<div class="chart"></div>').appendTo(this.$chartContainer),this.$startDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(r),this.$endDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(s),this.$startDate.datepicker($.extend({onSelect:$.proxy(this,"handleStartDateChange")},Craft.datepickerOptions)),this.$endDate.datepicker($.extend({onSelect:$.proxy(this,"handleEndDateChange")},Craft.datepickerOptions)),this.startDatepicker=this.$startDate.data("datepicker"),this.endDatepicker=this.$endDate.data("datepicker"),this.addListener(this.$startDate,"keyup","handleStartDateChange"),this.addListener(this.$endDate,"keyup","handleEndDateChange");var d=this.getStorage("startTime")||(new Date).getTime()-2592e6,l=this.getStorage("endTime")||(new Date).getTime();this.setStartDate(new Date(d)),this.setEndDate(new Date(l)),this.loadReport()},handleStartDateChange:function(){this.setStartDate(Craft.Freeform.SubmissionsTableView.getDateFromDatepickerInstance(this.startDatepicker))&&this.loadReport()},handleEndDateChange:function(){this.setEndDate(Craft.Freeform.SubmissionsTableView.getDateFromDatepickerInstance(this.endDatepicker))&&this.loadReport()},setStartDate:function(t){return(!this.startDate||t.getTime()!=this.startDate.getTime())&&(this.startDate=t,this.setStorage("startTime",this.startDate.getTime()),this.$startDate.val(Craft.formatDate(this.startDate)),this.endDate&&this.startDate.getTime()>this.endDate.getTime()&&this.setEndDate(new Date(this.startDate.getTime())),!0)},setEndDate:function(t){return(!this.endDate||t.getTime()!=this.endDate.getTime())&&(this.endDate=t,this.setStorage("endTime",this.endDate.getTime()),this.$endDate.val(Craft.formatDate(this.endDate)),this.startDate&&this.endDate.getTime()<this.startDate.getTime()&&this.setStartDate(new Date(this.endDate.getTime())),!0)},loadReport:function(){var t=this.settings.params;t.startDate=Craft.Freeform.SubmissionsTableView.getDateValue(this.startDate),t.endDate=Craft.Freeform.SubmissionsTableView.getDateValue(this.endDate),this.$spinner.removeClass("hidden"),this.$error.addClass("hidden"),this.$chart.removeClass("error"),Craft.postActionRequest("freeform/api/getSubmissionData",t,$.proxy(function(t,e){if(this.$spinner.addClass("hidden"),"success"==e&&"undefined"==typeof t.error){this.chart||(this.chart=new Craft.charts.Area(this.$chart));var a=new Craft.charts.DataTable(t.dataTable),r={localeDefinition:t.localeDefinition,orientation:t.orientation,formats:t.formats,dataScale:t.scale};this.chart.draw(a,r),this.$totalValue.html(t.totalHtml)}else{var s=Craft.t("An unknown error occurred.");"undefined"!=typeof t&&t&&"undefined"!=typeof t.error&&(s=t.error),this.$error.html(s),this.$error.removeClass("hidden"),this.$chart.addClass("error")}},this))}},{storage:{},getStorage:function(t,e){return Craft.Freeform.SubmissionsTableView.storage[t]&&Craft.Freeform.SubmissionsTableView.storage[t][e]?Craft.Freeform.SubmissionsTableView.storage[t][e]:null},setStorage:function(t,e,a){"undefined"==_typeof(Craft.Freeform.SubmissionsTableView.storage[t])&&(Craft.Freeform.SubmissionsTableView.storage[t]={}),Craft.Freeform.SubmissionsTableView.storage[t][e]=a},getDateFromDatepickerInstance:function(t){return new Date(t.currentYear,t.currentMonth,t.currentDay)},getDateValue:function(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZyZWVmb3JtLXN1Ym1pc3Npb25zLXRhYmxlLXZpZXcuanMiXSwibmFtZXMiOlsiX3R5cGVvZiIsIlN5bWJvbCIsIml0ZXJhdG9yIiwib2JqIiwiY29uc3RydWN0b3IiLCJwcm90b3R5cGUiLCJDcmFmdCIsIkZyZWVmb3JtIiwiU3VibWlzc2lvbnNUYWJsZVZpZXciLCJUYWJsZUVsZW1lbnRJbmRleFZpZXciLCJleHRlbmQiLCJzdGFydERhdGUiLCJlbmREYXRlIiwic3RhcnREYXRlcGlja2VyIiwiZW5kRGF0ZXBpY2tlciIsIiRjaGFydEV4cGxvcmVyIiwiJHRvdGFsVmFsdWUiLCIkY2hhcnRDb250YWluZXIiLCIkc3Bpbm5lciIsIiRlcnJvciIsIiRjaGFydCIsIiRzdGFydERhdGUiLCIkZW5kRGF0ZSIsImFmdGVySW5pdCIsInRoaXMiLCIkZXhwbG9yZXJDb250YWluZXIiLCIkIiwicHJlcGVuZFRvIiwiJGNvbnRhaW5lciIsImNyZWF0ZUNoYXJ0RXhwbG9yZXIiLCJiYXNlIiwiZ2V0U3RvcmFnZSIsImtleSIsImVsZW1lbnRJbmRleCIsIl9uYW1lc3BhY2UiLCJzZXRTdG9yYWdlIiwidmFsdWUiLCJhcHBlbmRUbyIsIiRjaGFydEhlYWRlciIsIiRkYXRlUmFuZ2UiLCIkc3RhcnREYXRlQ29udGFpbmVyIiwiJGVuZERhdGVDb250YWluZXIiLCIkdG90YWwiLCIkdG90YWxWYWx1ZVdyYXBwZXIiLCJ0IiwiZGF0ZXBpY2tlciIsIm9uU2VsZWN0IiwicHJveHkiLCJkYXRlcGlja2VyT3B0aW9ucyIsImRhdGEiLCJhZGRMaXN0ZW5lciIsInN0YXJ0VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwiZW5kVGltZSIsInNldFN0YXJ0RGF0ZSIsInNldEVuZERhdGUiLCJsb2FkUmVwb3J0IiwiaGFuZGxlU3RhcnREYXRlQ2hhbmdlIiwiZ2V0RGF0ZUZyb21EYXRlcGlja2VySW5zdGFuY2UiLCJoYW5kbGVFbmREYXRlQ2hhbmdlIiwiZGF0ZSIsInZhbCIsImZvcm1hdERhdGUiLCJyZXF1ZXN0RGF0YSIsInNldHRpbmdzIiwicGFyYW1zIiwiZ2V0RGF0ZVZhbHVlIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsInBvc3RBY3Rpb25SZXF1ZXN0IiwicmVzcG9uc2UiLCJ0ZXh0U3RhdHVzIiwiZXJyb3IiLCJjaGFydCIsImNoYXJ0cyIsIkFyZWEiLCJjaGFydERhdGFUYWJsZSIsIkRhdGFUYWJsZSIsImRhdGFUYWJsZSIsImNoYXJ0U2V0dGluZ3MiLCJsb2NhbGVEZWZpbml0aW9uIiwib3JpZW50YXRpb24iLCJmb3JtYXRzIiwiZGF0YVNjYWxlIiwic2NhbGUiLCJkcmF3IiwiaHRtbCIsInRvdGFsSHRtbCIsIm1zZyIsInN0b3JhZ2UiLCJuYW1lc3BhY2UiLCJpbnN0IiwiY3VycmVudFllYXIiLCJjdXJyZW50TW9udGgiLCJjdXJyZW50RGF5IiwiZ2V0RnVsbFllYXIiLCJnZXRNb250aCIsImdldERhdGUiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsSUFBSUEsU0FBNEIsa0JBQVhDLFNBQW9ELGdCQUFwQkEsUUFBT0MsU0FBd0IsU0FBVUMsR0FBTyxhQUFjQSxJQUFTLFNBQVVBLEdBQU8sTUFBT0EsSUFBeUIsa0JBQVhGLFNBQXlCRSxFQUFJQyxjQUFnQkgsUUFBVUUsSUFBUUYsT0FBT0ksVUFBWSxlQUFrQkYsR0FRbFEsZUFBQUgsUUFBT00sTUFBTUMsWUFDZkQsTUFBTUMsYUFNUkQsTUFBTUMsU0FBU0MscUJBQXVCRixNQUFNRyxzQkFBc0JDLFFBQzlEQyxVQUFXLEtBQ1hDLFFBQVMsS0FFVEMsZ0JBQWlCLEtBQ2pCQyxjQUFlLEtBRWZDLGVBQWdCLEtBQ2hCQyxZQUFhLEtBQ2JDLGdCQUFpQixLQUNqQkMsU0FBVSxLQUNWQyxPQUFRLEtBQ1JDLE9BQVEsS0FDUkMsV0FBWSxLQUNaQyxTQUFVLEtBRVZDLFVBQVcsV0FDVEMsS0FBS0MsbUJBQXFCQyxFQUFFLGdEQUFnREMsVUFBVUgsS0FBS0ksWUFFM0ZKLEtBQUtLLHNCQUVMTCxLQUFLTSxRQUdQQyxXQUFZLFNBQVVDLEdBQ3BCLE1BQU8xQixPQUFNQyxTQUFTQyxxQkFBcUJ1QixXQUFXUCxLQUFLUyxhQUFhQyxXQUFZRixJQUd0RkcsV0FBWSxTQUFVSCxFQUFLSSxHQUN6QjlCLE1BQU1DLFNBQVNDLHFCQUFxQjJCLFdBQVdYLEtBQUtTLGFBQWFDLFdBQVlGLEVBQUtJLElBR3BGUCxvQkFBcUIsV0FFbkIsR0FBSWQsR0FBc0JXLEVBQUUsc0NBQXNDVyxTQUFTYixLQUFLQyxvQkFDNUVhLEVBQXNCWixFQUFFLG9DQUFvQ1csU0FBU3RCLEdBQ3JFd0IsRUFBc0JiLEVBQUUsOEJBQThCVyxTQUFTQyxHQUMvREUsRUFBc0JkLEVBQUUsbUNBQW1DVyxTQUFTRSxHQUVwRUUsR0FEc0JmLEVBQUUsb0NBQW9DVyxTQUFTRSxHQUMvQ2IsRUFBRSxtQ0FBbUNXLFNBQVNFLElBQ3BFRyxFQUFzQmhCLEVBQUUsNkJBQTZCVyxTQUFTQyxHQUU5REssR0FEc0JqQixFQUFFLGtDQUFvQ3BCLE1BQU1zQyxFQUFFLHFCQUF1QixVQUFVUCxTQUFTSyxHQUN4RmhCLEVBQUUsMkNBQTJDVyxTQUFTSyxJQUM1RTFCLEVBQXNCVSxFQUFFLDJDQUEyQ1csU0FBU00sRUFFaEZuQixNQUFLVCxlQUFrQkEsRUFDdkJTLEtBQUtSLFlBQWtCQSxFQUN2QlEsS0FBS1AsZ0JBQWtCUyxFQUFFLHVDQUF1Q1csU0FBU3RCLEdBQ3pFUyxLQUFLTixTQUFrQlEsRUFBRSxrQ0FBa0NDLFVBQVVXLEdBQ3JFZCxLQUFLTCxPQUFrQk8sRUFBRSw2QkFBNkJXLFNBQVNiLEtBQUtQLGlCQUNwRU8sS0FBS0osT0FBa0JNLEVBQUUsNkJBQTZCVyxTQUFTYixLQUFLUCxpQkFFcEVPLEtBQUtILFdBQWFLLEVBQUUsbUVBQW1FVyxTQUFTRyxHQUNoR2hCLEtBQUtGLFNBQWFJLEVBQUUsbUVBQW1FVyxTQUFTSSxHQUVoR2pCLEtBQUtILFdBQVd3QixXQUFXbkIsRUFBRWhCLFFBQzNCb0MsU0FBVXBCLEVBQUVxQixNQUFNdkIsS0FBTSwwQkFDdkJsQixNQUFNMEMsb0JBRVR4QixLQUFLRixTQUFTdUIsV0FBV25CLEVBQUVoQixRQUN6Qm9DLFNBQVVwQixFQUFFcUIsTUFBTXZCLEtBQU0sd0JBQ3ZCbEIsTUFBTTBDLG9CQUVUeEIsS0FBS1gsZ0JBQWtCVyxLQUFLSCxXQUFXNEIsS0FBSyxjQUM1Q3pCLEtBQUtWLGNBQWtCVSxLQUFLRixTQUFTMkIsS0FBSyxjQUUxQ3pCLEtBQUswQixZQUFZMUIsS0FBS0gsV0FBWSxRQUFTLHlCQUMzQ0csS0FBSzBCLFlBQVkxQixLQUFLRixTQUFVLFFBQVMsc0JBR3pDLElBQUk2QixHQUFZM0IsS0FBS08sV0FBVyxlQUFrQixHQUFJcUIsT0FBUUMsVUFBYSxPQUN2RUMsRUFBWTlCLEtBQUtPLFdBQVcsYUFBZ0IsR0FBSXFCLE9BQVFDLFNBRTVEN0IsTUFBSytCLGFBQWEsR0FBSUgsTUFBS0QsSUFDM0IzQixLQUFLZ0MsV0FBVyxHQUFJSixNQUFLRSxJQUd6QjlCLEtBQUtpQyxjQUdQQyxzQkFBdUIsV0FDakJsQyxLQUFLK0IsYUFBYWpELE1BQU1DLFNBQVNDLHFCQUFxQm1ELDhCQUE4Qm5DLEtBQUtYLG1CQUMzRlcsS0FBS2lDLGNBSVRHLG9CQUFxQixXQUNmcEMsS0FBS2dDLFdBQVdsRCxNQUFNQyxTQUFTQyxxQkFBcUJtRCw4QkFBOEJuQyxLQUFLVixpQkFDekZVLEtBQUtpQyxjQUlURixhQUFjLFNBQVVNLEdBRXRCLFFBQUlyQyxLQUFLYixXQUFha0QsRUFBS1IsV0FBYTdCLEtBQUtiLFVBQVUwQyxhQUl2RDdCLEtBQUtiLFVBQVlrRCxFQUNqQnJDLEtBQUtXLFdBQVcsWUFBYVgsS0FBS2IsVUFBVTBDLFdBQzVDN0IsS0FBS0gsV0FBV3lDLElBQUl4RCxNQUFNeUQsV0FBV3ZDLEtBQUtiLFlBR3RDYSxLQUFLWixTQUFXWSxLQUFLYixVQUFVMEMsVUFBWTdCLEtBQUtaLFFBQVF5QyxXQUMxRDdCLEtBQUtnQyxXQUFXLEdBQUlKLE1BQUs1QixLQUFLYixVQUFVMEMsYUFHbkMsSUFHVEcsV0FBWSxTQUFVSyxHQUVwQixRQUFJckMsS0FBS1osU0FBV2lELEVBQUtSLFdBQWE3QixLQUFLWixRQUFReUMsYUFJbkQ3QixLQUFLWixRQUFVaUQsRUFDZnJDLEtBQUtXLFdBQVcsVUFBV1gsS0FBS1osUUFBUXlDLFdBQ3hDN0IsS0FBS0YsU0FBU3dDLElBQUl4RCxNQUFNeUQsV0FBV3ZDLEtBQUtaLFVBR3BDWSxLQUFLYixXQUFhYSxLQUFLWixRQUFReUMsVUFBWTdCLEtBQUtiLFVBQVUwQyxXQUM1RDdCLEtBQUsrQixhQUFhLEdBQUlILE1BQUs1QixLQUFLWixRQUFReUMsYUFHbkMsSUFHVEksV0FBWSxXQUNWLEdBQUlPLEdBQWN4QyxLQUFLeUMsU0FBU0MsTUFFaENGLEdBQVlyRCxVQUFZTCxNQUFNQyxTQUFTQyxxQkFBcUIyRCxhQUFhM0MsS0FBS2IsV0FDOUVxRCxFQUFZcEQsUUFBWU4sTUFBTUMsU0FBU0MscUJBQXFCMkQsYUFBYTNDLEtBQUtaLFNBRTlFWSxLQUFLTixTQUFTa0QsWUFBWSxVQUMxQjVDLEtBQUtMLE9BQU9rRCxTQUFTLFVBQ3JCN0MsS0FBS0osT0FBT2dELFlBQVksU0FFeEI5RCxNQUFNZ0Usa0JBQWtCLGlDQUFrQ04sRUFBYXRDLEVBQUVxQixNQUFNLFNBQVV3QixFQUFVQyxHQUdqRyxHQUZBaEQsS0FBS04sU0FBU21ELFNBQVMsVUFFTCxXQUFkRyxHQUFxRCxtQkFBbkJELEdBQVNFLE1BQXVCLENBQy9EakQsS0FBS2tELFFBQ1JsRCxLQUFLa0QsTUFBUSxHQUFJcEUsT0FBTXFFLE9BQU9DLEtBQUtwRCxLQUFLSixRQUcxQyxJQUFJeUQsR0FBaUIsR0FBSXZFLE9BQU1xRSxPQUFPRyxVQUFVUCxFQUFTUSxXQUVyREMsR0FDRkMsaUJBQWtCVixFQUFTVSxpQkFDM0JDLFlBQWFYLEVBQVNXLFlBQ3RCQyxRQUFTWixFQUFTWSxRQUNsQkMsVUFBV2IsRUFBU2MsTUFHdEI3RCxNQUFLa0QsTUFBTVksS0FBS1QsRUFBZ0JHLEdBRWhDeEQsS0FBS1IsWUFBWXVFLEtBQUtoQixFQUFTaUIsZUFFNUIsQ0FDSCxHQUFJQyxHQUFNbkYsTUFBTXNDLEVBQUUsNkJBRU0sb0JBQWIyQixJQUE0QkEsR0FBc0MsbUJBQW5CQSxHQUFTRSxRQUNqRWdCLEVBQU1sQixFQUFTRSxPQUdqQmpELEtBQUtMLE9BQU9vRSxLQUFLRSxHQUNqQmpFLEtBQUtMLE9BQU9pRCxZQUFZLFVBQ3hCNUMsS0FBS0osT0FBT2lELFNBQVMsV0FFdEI3QyxVQUlMa0UsV0FFQTNELFdBQVksU0FBVTRELEVBQVczRCxHQUMvQixNQUFJMUIsT0FBTUMsU0FBU0MscUJBQXFCa0YsUUFBUUMsSUFBY3JGLE1BQU1DLFNBQVNDLHFCQUFxQmtGLFFBQVFDLEdBQVczRCxHQUM1RzFCLE1BQU1DLFNBQVNDLHFCQUFxQmtGLFFBQVFDLEdBQVczRCxHQUd6RCxNQUdURyxXQUFZLFNBQVV3RCxFQUFXM0QsRUFBS0ksR0FDaEMsYUFBQXBDLFFBQU9NLE1BQU1DLFNBQVNDLHFCQUFxQmtGLFFBQVFDLE1BQ3JEckYsTUFBTUMsU0FBU0MscUJBQXFCa0YsUUFBUUMsT0FHOUNyRixNQUFNQyxTQUFTQyxxQkFBcUJrRixRQUFRQyxHQUFXM0QsR0FBT0ksR0FHaEV1Qiw4QkFBK0IsU0FBVWlDLEdBQ3ZDLE1BQU8sSUFBSXhDLE1BQUt3QyxFQUFLQyxZQUFhRCxFQUFLRSxhQUFjRixFQUFLRyxhQUc1RDVCLGFBQWMsU0FBVU4sR0FDdEIsTUFBT0EsR0FBS21DLGNBQWdCLEtBQU9uQyxFQUFLb0MsV0FBYSxHQUFLLElBQU1wQyxFQUFLcUMiLCJmaWxlIjoiZnJlZWZvcm0tc3VibWlzc2lvbnMtdGFibGUtdmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBGcmVlZm9ybSBmb3IgQ3JhZnRcbiAqXG4gKiBAcGFja2FnZSAgICAgICBTb2xzcGFjZTpGcmVlZm9ybVxuICogQGF1dGhvciAgICAgICAgU29sc3BhY2UsIEluYy5cbiAqIEBjb3B5cmlnaHQgICAgIENvcHlyaWdodCAoYykgMjAwOC0yMDE2LCBTb2xzcGFjZSwgSW5jLlxuICogQGxpbmsgICAgICAgICAgaHR0cHM6Ly9zb2xzcGFjZS5jb20vY3JhZnQvZnJlZWZvcm1cbiAqIEBsaWNlbnNlICAgICAgIGh0dHBzOi8vc29sc3BhY2UuY29tL3NvZnR3YXJlL2xpY2Vuc2UtYWdyZWVtZW50XG4gKi9cblxuaWYgKHR5cGVvZiBDcmFmdC5GcmVlZm9ybSA9PT0gdHlwZW9mIHVuZGVmaW5lZCkge1xuICBDcmFmdC5GcmVlZm9ybSA9IHt9O1xufVxuXG4vKipcbiAqIENsYXNzIENyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3XG4gKi9cbkNyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3ID0gQ3JhZnQuVGFibGVFbGVtZW50SW5kZXhWaWV3LmV4dGVuZCh7XG4gICAgc3RhcnREYXRlOiBudWxsLFxuICAgIGVuZERhdGU6IG51bGwsXG5cbiAgICBzdGFydERhdGVwaWNrZXI6IG51bGwsXG4gICAgZW5kRGF0ZXBpY2tlcjogbnVsbCxcblxuICAgICRjaGFydEV4cGxvcmVyOiBudWxsLFxuICAgICR0b3RhbFZhbHVlOiBudWxsLFxuICAgICRjaGFydENvbnRhaW5lcjogbnVsbCxcbiAgICAkc3Bpbm5lcjogbnVsbCxcbiAgICAkZXJyb3I6IG51bGwsXG4gICAgJGNoYXJ0OiBudWxsLFxuICAgICRzdGFydERhdGU6IG51bGwsXG4gICAgJGVuZERhdGU6IG51bGwsXG5cbiAgICBhZnRlckluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuJGV4cGxvcmVyQ29udGFpbmVyID0gJCgnPGRpdiBjbGFzcz1cImNoYXJ0LWV4cGxvcmVyLWNvbnRhaW5lclwiPjwvZGl2PicpLnByZXBlbmRUbyh0aGlzLiRjb250YWluZXIpO1xuXG4gICAgICB0aGlzLmNyZWF0ZUNoYXJ0RXhwbG9yZXIoKTtcblxuICAgICAgdGhpcy5iYXNlKCk7XG4gICAgfSxcblxuICAgIGdldFN0b3JhZ2U6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIHJldHVybiBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5nZXRTdG9yYWdlKHRoaXMuZWxlbWVudEluZGV4Ll9uYW1lc3BhY2UsIGtleSk7XG4gICAgfSxcblxuICAgIHNldFN0b3JhZ2U6IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5zZXRTdG9yYWdlKHRoaXMuZWxlbWVudEluZGV4Ll9uYW1lc3BhY2UsIGtleSwgdmFsdWUpO1xuICAgIH0sXG5cbiAgICBjcmVhdGVDaGFydEV4cGxvcmVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBjaGFydCBleHBsb3JlclxuICAgICAgdmFyICRjaGFydEV4cGxvcmVyICAgICAgPSAkKCc8ZGl2IGNsYXNzPVwiY2hhcnQtZXhwbG9yZXJcIj48L2Rpdj4nKS5hcHBlbmRUbyh0aGlzLiRleHBsb3JlckNvbnRhaW5lciksXG4gICAgICAgICAgJGNoYXJ0SGVhZGVyICAgICAgICA9ICQoJzxkaXYgY2xhc3M9XCJjaGFydC1oZWFkZXJcIj48L2Rpdj4nKS5hcHBlbmRUbygkY2hhcnRFeHBsb3JlciksXG4gICAgICAgICAgJGRhdGVSYW5nZSAgICAgICAgICA9ICQoJzxkaXYgY2xhc3M9XCJkYXRlLXJhbmdlXCIgLz4nKS5hcHBlbmRUbygkY2hhcnRIZWFkZXIpLFxuICAgICAgICAgICRzdGFydERhdGVDb250YWluZXIgPSAkKCc8ZGl2IGNsYXNzPVwiZGF0ZXdyYXBwZXJcIj48L2Rpdj4nKS5hcHBlbmRUbygkZGF0ZVJhbmdlKSxcbiAgICAgICAgICAkdG8gICAgICAgICAgICAgICAgID0gJCgnPHNwYW4gY2xhc3M9XCJ0byBsaWdodFwiPnRvPC9zcGFuPicpLmFwcGVuZFRvKCRkYXRlUmFuZ2UpLFxuICAgICAgICAgICRlbmREYXRlQ29udGFpbmVyICAgPSAkKCc8ZGl2IGNsYXNzPVwiZGF0ZXdyYXBwZXJcIj48L2Rpdj4nKS5hcHBlbmRUbygkZGF0ZVJhbmdlKSxcbiAgICAgICAgICAkdG90YWwgICAgICAgICAgICAgID0gJCgnPGRpdiBjbGFzcz1cInRvdGFsXCI+PC9kaXY+JykuYXBwZW5kVG8oJGNoYXJ0SGVhZGVyKSxcbiAgICAgICAgICAkdG90YWxMYWJlbCAgICAgICAgID0gJCgnPGRpdiBjbGFzcz1cInRvdGFsLWxhYmVsIGxpZ2h0XCI+JyArIENyYWZ0LnQoJ1RvdGFsIFN1Ym1pc3Npb25zJykgKyAnPC9kaXY+JykuYXBwZW5kVG8oJHRvdGFsKSxcbiAgICAgICAgICAkdG90YWxWYWx1ZVdyYXBwZXIgID0gJCgnPGRpdiBjbGFzcz1cInRvdGFsLXZhbHVlLXdyYXBwZXJcIj48L2Rpdj4nKS5hcHBlbmRUbygkdG90YWwpLFxuICAgICAgICAgICR0b3RhbFZhbHVlICAgICAgICAgPSAkKCc8c3BhbiBjbGFzcz1cInRvdGFsLXZhbHVlXCI+Jm5ic3A7PC9zcGFuPicpLmFwcGVuZFRvKCR0b3RhbFZhbHVlV3JhcHBlcik7XG5cbiAgICAgIHRoaXMuJGNoYXJ0RXhwbG9yZXIgID0gJGNoYXJ0RXhwbG9yZXI7XG4gICAgICB0aGlzLiR0b3RhbFZhbHVlICAgICA9ICR0b3RhbFZhbHVlO1xuICAgICAgdGhpcy4kY2hhcnRDb250YWluZXIgPSAkKCc8ZGl2IGNsYXNzPVwiY2hhcnQtY29udGFpbmVyXCI+PC9kaXY+JykuYXBwZW5kVG8oJGNoYXJ0RXhwbG9yZXIpO1xuICAgICAgdGhpcy4kc3Bpbm5lciAgICAgICAgPSAkKCc8ZGl2IGNsYXNzPVwic3Bpbm5lciBoaWRkZW5cIiAvPicpLnByZXBlbmRUbygkY2hhcnRIZWFkZXIpO1xuICAgICAgdGhpcy4kZXJyb3IgICAgICAgICAgPSAkKCc8ZGl2IGNsYXNzPVwiZXJyb3JcIj48L2Rpdj4nKS5hcHBlbmRUbyh0aGlzLiRjaGFydENvbnRhaW5lcik7XG4gICAgICB0aGlzLiRjaGFydCAgICAgICAgICA9ICQoJzxkaXYgY2xhc3M9XCJjaGFydFwiPjwvZGl2PicpLmFwcGVuZFRvKHRoaXMuJGNoYXJ0Q29udGFpbmVyKTtcblxuICAgICAgdGhpcy4kc3RhcnREYXRlID0gJCgnPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJ0ZXh0XCIgc2l6ZT1cIjIwXCIgYXV0b2NvbXBsZXRlPVwib2ZmXCIgLz4nKS5hcHBlbmRUbygkc3RhcnREYXRlQ29udGFpbmVyKTtcbiAgICAgIHRoaXMuJGVuZERhdGUgICA9ICQoJzxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwidGV4dFwiIHNpemU9XCIyMFwiIGF1dG9jb21wbGV0ZT1cIm9mZlwiIC8+JykuYXBwZW5kVG8oJGVuZERhdGVDb250YWluZXIpO1xuXG4gICAgICB0aGlzLiRzdGFydERhdGUuZGF0ZXBpY2tlcigkLmV4dGVuZCh7XG4gICAgICAgIG9uU2VsZWN0OiAkLnByb3h5KHRoaXMsICdoYW5kbGVTdGFydERhdGVDaGFuZ2UnKVxuICAgICAgfSwgQ3JhZnQuZGF0ZXBpY2tlck9wdGlvbnMpKTtcblxuICAgICAgdGhpcy4kZW5kRGF0ZS5kYXRlcGlja2VyKCQuZXh0ZW5kKHtcbiAgICAgICAgb25TZWxlY3Q6ICQucHJveHkodGhpcywgJ2hhbmRsZUVuZERhdGVDaGFuZ2UnKVxuICAgICAgfSwgQ3JhZnQuZGF0ZXBpY2tlck9wdGlvbnMpKTtcblxuICAgICAgdGhpcy5zdGFydERhdGVwaWNrZXIgPSB0aGlzLiRzdGFydERhdGUuZGF0YSgnZGF0ZXBpY2tlcicpO1xuICAgICAgdGhpcy5lbmREYXRlcGlja2VyICAgPSB0aGlzLiRlbmREYXRlLmRhdGEoJ2RhdGVwaWNrZXInKTtcblxuICAgICAgdGhpcy5hZGRMaXN0ZW5lcih0aGlzLiRzdGFydERhdGUsICdrZXl1cCcsICdoYW5kbGVTdGFydERhdGVDaGFuZ2UnKTtcbiAgICAgIHRoaXMuYWRkTGlzdGVuZXIodGhpcy4kZW5kRGF0ZSwgJ2tleXVwJywgJ2hhbmRsZUVuZERhdGVDaGFuZ2UnKTtcblxuICAgICAgLy8gU2V0IHRoZSBzdGFydC9lbmQgZGF0ZXNcbiAgICAgIHZhciBzdGFydFRpbWUgPSB0aGlzLmdldFN0b3JhZ2UoJ3N0YXJ0VGltZScpIHx8ICgobmV3IERhdGUoKSkuZ2V0VGltZSgpIC0gKDYwICogNjAgKiAyNCAqIDMwICogMTAwMCkpLFxuICAgICAgICAgIGVuZFRpbWUgICA9IHRoaXMuZ2V0U3RvcmFnZSgnZW5kVGltZScpIHx8ICgobmV3IERhdGUoKSkuZ2V0VGltZSgpKTtcblxuICAgICAgdGhpcy5zZXRTdGFydERhdGUobmV3IERhdGUoc3RhcnRUaW1lKSk7XG4gICAgICB0aGlzLnNldEVuZERhdGUobmV3IERhdGUoZW5kVGltZSkpO1xuXG4gICAgICAvLyBMb2FkIHRoZSByZXBvcnRcbiAgICAgIHRoaXMubG9hZFJlcG9ydCgpO1xuICAgIH0sXG5cbiAgICBoYW5kbGVTdGFydERhdGVDaGFuZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLnNldFN0YXJ0RGF0ZShDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5nZXREYXRlRnJvbURhdGVwaWNrZXJJbnN0YW5jZSh0aGlzLnN0YXJ0RGF0ZXBpY2tlcikpKSB7XG4gICAgICAgIHRoaXMubG9hZFJlcG9ydCgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBoYW5kbGVFbmREYXRlQ2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5zZXRFbmREYXRlKENyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3LmdldERhdGVGcm9tRGF0ZXBpY2tlckluc3RhbmNlKHRoaXMuZW5kRGF0ZXBpY2tlcikpKSB7XG4gICAgICAgIHRoaXMubG9hZFJlcG9ydCgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRTdGFydERhdGU6IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgICAvLyBNYWtlIHN1cmUgaXQgaGFzIGFjdHVhbGx5IGNoYW5nZWRcbiAgICAgIGlmICh0aGlzLnN0YXJ0RGF0ZSAmJiBkYXRlLmdldFRpbWUoKSA9PSB0aGlzLnN0YXJ0RGF0ZS5nZXRUaW1lKCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnN0YXJ0RGF0ZSA9IGRhdGU7XG4gICAgICB0aGlzLnNldFN0b3JhZ2UoJ3N0YXJ0VGltZScsIHRoaXMuc3RhcnREYXRlLmdldFRpbWUoKSk7XG4gICAgICB0aGlzLiRzdGFydERhdGUudmFsKENyYWZ0LmZvcm1hdERhdGUodGhpcy5zdGFydERhdGUpKTtcblxuICAgICAgLy8gSWYgdGhpcyBpcyBhZnRlciB0aGUgY3VycmVudCBlbmQgZGF0ZSwgc2V0IHRoZSBlbmQgZGF0ZSB0byBtYXRjaCBpdFxuICAgICAgaWYgKHRoaXMuZW5kRGF0ZSAmJiB0aGlzLnN0YXJ0RGF0ZS5nZXRUaW1lKCkgPiB0aGlzLmVuZERhdGUuZ2V0VGltZSgpKSB7XG4gICAgICAgIHRoaXMuc2V0RW5kRGF0ZShuZXcgRGF0ZSh0aGlzLnN0YXJ0RGF0ZS5nZXRUaW1lKCkpKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIHNldEVuZERhdGU6IGZ1bmN0aW9uIChkYXRlKSB7XG4gICAgICAvLyBNYWtlIHN1cmUgaXQgaGFzIGFjdHVhbGx5IGNoYW5nZWRcbiAgICAgIGlmICh0aGlzLmVuZERhdGUgJiYgZGF0ZS5nZXRUaW1lKCkgPT0gdGhpcy5lbmREYXRlLmdldFRpbWUoKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZW5kRGF0ZSA9IGRhdGU7XG4gICAgICB0aGlzLnNldFN0b3JhZ2UoJ2VuZFRpbWUnLCB0aGlzLmVuZERhdGUuZ2V0VGltZSgpKTtcbiAgICAgIHRoaXMuJGVuZERhdGUudmFsKENyYWZ0LmZvcm1hdERhdGUodGhpcy5lbmREYXRlKSk7XG5cbiAgICAgIC8vIElmIHRoaXMgaXMgYmVmb3JlIHRoZSBjdXJyZW50IHN0YXJ0IGRhdGUsIHNldCB0aGUgc3RhcnQgZGF0ZSB0byBtYXRjaCBpdFxuICAgICAgaWYgKHRoaXMuc3RhcnREYXRlICYmIHRoaXMuZW5kRGF0ZS5nZXRUaW1lKCkgPCB0aGlzLnN0YXJ0RGF0ZS5nZXRUaW1lKCkpIHtcbiAgICAgICAgdGhpcy5zZXRTdGFydERhdGUobmV3IERhdGUodGhpcy5lbmREYXRlLmdldFRpbWUoKSkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgbG9hZFJlcG9ydDogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJlcXVlc3REYXRhID0gdGhpcy5zZXR0aW5ncy5wYXJhbXM7XG5cbiAgICAgIHJlcXVlc3REYXRhLnN0YXJ0RGF0ZSA9IENyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3LmdldERhdGVWYWx1ZSh0aGlzLnN0YXJ0RGF0ZSk7XG4gICAgICByZXF1ZXN0RGF0YS5lbmREYXRlICAgPSBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5nZXREYXRlVmFsdWUodGhpcy5lbmREYXRlKTtcblxuICAgICAgdGhpcy4kc3Bpbm5lci5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICB0aGlzLiRlcnJvci5hZGRDbGFzcygnaGlkZGVuJyk7XG4gICAgICB0aGlzLiRjaGFydC5yZW1vdmVDbGFzcygnZXJyb3InKTtcblxuICAgICAgQ3JhZnQucG9zdEFjdGlvblJlcXVlc3QoJ2ZyZWVmb3JtL2FwaS9nZXRTdWJtaXNzaW9uRGF0YScsIHJlcXVlc3REYXRhLCAkLnByb3h5KGZ1bmN0aW9uIChyZXNwb25zZSwgdGV4dFN0YXR1cykge1xuICAgICAgICB0aGlzLiRzcGlubmVyLmFkZENsYXNzKCdoaWRkZW4nKTtcblxuICAgICAgICBpZiAodGV4dFN0YXR1cyA9PSAnc3VjY2VzcycgJiYgdHlwZW9mKHJlc3BvbnNlLmVycm9yKSA9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIGlmICghdGhpcy5jaGFydCkge1xuICAgICAgICAgICAgdGhpcy5jaGFydCA9IG5ldyBDcmFmdC5jaGFydHMuQXJlYSh0aGlzLiRjaGFydCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIGNoYXJ0RGF0YVRhYmxlID0gbmV3IENyYWZ0LmNoYXJ0cy5EYXRhVGFibGUocmVzcG9uc2UuZGF0YVRhYmxlKTtcblxuICAgICAgICAgIHZhciBjaGFydFNldHRpbmdzID0ge1xuICAgICAgICAgICAgbG9jYWxlRGVmaW5pdGlvbjogcmVzcG9uc2UubG9jYWxlRGVmaW5pdGlvbixcbiAgICAgICAgICAgIG9yaWVudGF0aW9uOiByZXNwb25zZS5vcmllbnRhdGlvbixcbiAgICAgICAgICAgIGZvcm1hdHM6IHJlc3BvbnNlLmZvcm1hdHMsXG4gICAgICAgICAgICBkYXRhU2NhbGU6IHJlc3BvbnNlLnNjYWxlXG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHRoaXMuY2hhcnQuZHJhdyhjaGFydERhdGFUYWJsZSwgY2hhcnRTZXR0aW5ncyk7XG5cbiAgICAgICAgICB0aGlzLiR0b3RhbFZhbHVlLmh0bWwocmVzcG9uc2UudG90YWxIdG1sKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB2YXIgbXNnID0gQ3JhZnQudCgnQW4gdW5rbm93biBlcnJvciBvY2N1cnJlZC4nKTtcblxuICAgICAgICAgIGlmICh0eXBlb2YocmVzcG9uc2UpICE9ICd1bmRlZmluZWQnICYmIHJlc3BvbnNlICYmIHR5cGVvZihyZXNwb25zZS5lcnJvcikgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIG1zZyA9IHJlc3BvbnNlLmVycm9yO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuJGVycm9yLmh0bWwobXNnKTtcbiAgICAgICAgICB0aGlzLiRlcnJvci5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgICAgdGhpcy4kY2hhcnQuYWRkQ2xhc3MoJ2Vycm9yJyk7XG4gICAgICAgIH1cbiAgICAgIH0sIHRoaXMpKTtcbiAgICB9XG4gIH0sXG4gIHtcbiAgICBzdG9yYWdlOiB7fSxcblxuICAgIGdldFN0b3JhZ2U6IGZ1bmN0aW9uIChuYW1lc3BhY2UsIGtleSkge1xuICAgICAgaWYgKENyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3LnN0b3JhZ2VbbmFtZXNwYWNlXSAmJiBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5zdG9yYWdlW25hbWVzcGFjZV1ba2V5XSkge1xuICAgICAgICByZXR1cm4gQ3JhZnQuRnJlZWZvcm0uU3VibWlzc2lvbnNUYWJsZVZpZXcuc3RvcmFnZVtuYW1lc3BhY2VdW2tleV07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICBzZXRTdG9yYWdlOiBmdW5jdGlvbiAobmFtZXNwYWNlLCBrZXksIHZhbHVlKSB7XG4gICAgICBpZiAodHlwZW9mIENyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3LnN0b3JhZ2VbbmFtZXNwYWNlXSA9PSB0eXBlb2YgdW5kZWZpbmVkKSB7XG4gICAgICAgIENyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3LnN0b3JhZ2VbbmFtZXNwYWNlXSA9IHt9O1xuICAgICAgfVxuXG4gICAgICBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5zdG9yYWdlW25hbWVzcGFjZV1ba2V5XSA9IHZhbHVlO1xuICAgIH0sXG5cbiAgICBnZXREYXRlRnJvbURhdGVwaWNrZXJJbnN0YW5jZTogZnVuY3Rpb24gKGluc3QpIHtcbiAgICAgIHJldHVybiBuZXcgRGF0ZShpbnN0LmN1cnJlbnRZZWFyLCBpbnN0LmN1cnJlbnRNb250aCwgaW5zdC5jdXJyZW50RGF5KTtcbiAgICB9LFxuXG4gICAgZ2V0RGF0ZVZhbHVlOiBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICAgcmV0dXJuIGRhdGUuZ2V0RnVsbFllYXIoKSArICctJyArIChkYXRlLmdldE1vbnRoKCkgKyAxKSArICctJyArIGRhdGUuZ2V0RGF0ZSgpO1xuICAgIH1cbiAgfVxuKTtcbiJdfQ==
